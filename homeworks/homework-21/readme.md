# Торговая платформа

Дополним задачу построения логики торговой платформы возможностью параллельной оработы трейдеров. Для этого существующее решение изменено таким образом, чтобы осуществлять сведение ордеров в отдельном компоненте ([TradingEngine](../homework-10/sample/TradingApp/TradingApp/Trading%20Logic/TradingEngine.cs)).

Задача этого компонента - закрытие ордеров на покупку/продажу определенного количества акций по определенной цене. Для этого можно использовать весь спекрт изученных инструментов. Однако надо принимать во внимание следующие условия:

  - Ордера добавляются параллельно разными "пользователями"
  - Ордер может быть размещен без указания цены, при этом стоимость покупки/продажи будет определяться по минимальной/максимальной на момент размещения с учетом обхемы сделки
  - Рыночная цена акции за определенный период времени определяется на основе заключенных ордеров

## Таблица ордеров

В определенный момент времени заказы на покупку/продажу акций могут быть представлены в виде таблицы

Id  | Side | Time  |  Qty|  Price|  Qty|  Time | Side |
|---|------|-------|-----|-------|-----|-------|------|
#3  |      |       |     |  20.30|  200|  09:05| SELL |
#1  |      |       |     |  20.30|  100|  09:01| SELL |
#2  |      |       |     |  20.25|  100|  09:03| SELL |
#7  | BUY  | 09:09 | 200 |       |     |       |      |
#5  | BUY  | 09:08 | 200 |  20.20|     |       |      |
#4  | BUY  | 09:06 | 100 |  20.15|     |       |      |
#6  | BUY  | 09:09 | 200 |  20.15|     |       |      |

## Сведение ордеров

Выполнение ордеров (заключение сделок) на определенное количество акций по определенной цене может выполняться согласно разным алгоритмам и называется `сведение ордеров`. Ниже рассмотрено 2 варианта такого рода сведения.

### Приоритет Цена/Время (FIFO)

При создании заказа `limit order` "купить 250 акций по 20.35" он выполняется в следующем порядке

1. 100 акций за 20.25 (order #2, остаток 150)
2. 100 акций за 20.30 (order #1)
3. 50 акций за 20.30 (order #3)

Итоговая таблица будет выглядеть так

Id  | Side | Time  |  Qty|  Price|  Qty|  Time | Side |
|---|------|-------|-----|-------|-----|-------|------|
#3  |      |       |     |  20.30|  150|  09:05| SELL |
#5  | BUY  | 09:08 | 200 |  20.20|     |       |      |
#4  | BUY  | 09:06 | 100 |  20.15|     |       |      |
#6  | BUY  | 09:09 | 200 |  20.15|     |       |      |

### Алгоритм Pro-Rata

При создании заказа `limit order` "купить 250 акций по 20.35" он выполняется в следующем порядке

1. 100@20.25 (order #2, остаток 150)
2. 50@20.30 (order #1, 150 x 1/3 = 50)
3. 100@20.30 (order #3, 150 x 2/3 = 100)

Итоговая таблица будет выглядеть так

Id  | Side | Time  |  Qty|  Price|  Qty|  Time | Side |
|---|------|-------|-----|-------|-----|-------|------|
#3  |      |       |     |  20.30|  100|  09:05| SELL |
#1  |      |       |     |  20.30|  50 |  09:01| SELL |
#5  | BUY  | 09:08 | 200 |  20.20|     |       |      |
#4  | BUY  | 09:06 | 100 |  20.15|     |       |      |
#6  | BUY  | 09:09 | 200 |  20.15|     |       |      |

## Компоненты программы

Все решение торговой платформы можно разделить на следующие компоненты

1. Основной торговый движок - **размещение и сведение ордеров**
2. Управление и изменения состояния пользовательских акаунтов - **Изменение баланса, валидация и обработка результатов заключенных сделок**
3. Сохранение и предоставление исторических данных по цене акций - **Аналог базы данных для хранения информаци**
4. Взаимодействие с пользователем - **Просмотр данных по акциям, баланса, возможность совершать торговые операции**
5. Эмулятор работы торговой платформы - **Конкурентное создание ордеров для тестирования возможностей платформы**

Все эти компоненты должны работать в конкурентной многопоточной среде, сохраняя при этом стабильное и предсказуемое состояние.
